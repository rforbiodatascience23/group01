---
title: "Lab 7 Assignment: Group 01"
format:
  html:
    embed-resources: true
editor: visual
---

# Lab 7 Assignment

## Breast Cancer PCA report

In the realm of breast cancer research, the analysis of biopsied tissue samples holds immense promise in unraveling the intricacies of this pervasive disease. Breast cancer is not a singular entity; rather, it encompasses a spectrum of subtypes with varying characteristics and outcomes. To better comprehend the underlying structure and patterns within the data derived from breast cancer biopsies, this assignment embarks on a journey into the world of Principal Component Analysis (PCA).

The biopsy dataset at hand consist in a breast cancer dataset from the University of Wisconsin Hospitals, Madison from Dr. William H. Wolberg. The dataset contains the biopsies of breast tumors for 699 patients and comprises 9 critical features, including clump thickness, cell size, cell shape, adhesion properties, and more, each contributing to the comprehensive assessment of breast cancer cases. The tenth attribute is the true outcome (benign/malignant).

Through PCA, we seek to reduce the dimensionality of this complex dataset while retaining the essential information, ultimately facilitating the identification of inherent patterns, correlations, and potential insights that can aid in diagnosing and understanding breast cancer. By harnessing the power of PCA, we aim to shed light on the underlying structure of breast cancer biopsy data, fostering a deeper appreciation of its clinical relevance and potential implications for improved patient care and outcomes.

## Load Libraries

```{r}
library(tidyverse)
library(broom)  # devtools::install_github("tidymodels/broom")
library(cowplot)
```

## Load Data

```{r}
biopsy <- read_csv("https://wilkelab.org/classes/SDS348/data_sets/biopsy.csv")
```

## Data Wrangling

```{r}
pca_fit <- biopsy |> 
  select(where(is.numeric)) |> # retain only numeric columns
  prcomp(scale = TRUE) # do PCA on scaled data

pca_fit <- biopsy |> 
  select(where(is.numeric)) |> # retain only numeric columns
  scale() |> # scale data
  prcomp() # do PCA
```

## Analysis

```{r}
pca_fit |>
  augment(biopsy) |> # add original dataset back in
  ggplot(aes(.fittedPC1, 
             .fittedPC2, 
             color = outcome)) + 
  geom_point(size = 1.5) +
  scale_color_manual(values = c(malignant = "#D55E00", 
                                benign = "#0072B2")) +
  labs(title = "PC coordinates", 
       x = "Fitted PC1", 
       y = "Fitted PC2", 
       color = "Outcome") +
  theme_half_open(12) + 
  background_grid()

# extract rotation matrix
pca_fit |>
  tidy(matrix = "rotation")

# define arrow style for plotting
arrow_style <- arrow(angle = 20, 
                     ends = "first", 
                     type = "closed", 
                     length = grid::unit(8, "pt"))

# plot rotation matrix
pca_fit |>
  tidy(matrix = "rotation") |>
  pivot_wider(names_from = "PC", 
              names_prefix = "PC", 
              values_from = "value") |>
  ggplot(aes(PC1, PC2)) +
  geom_segment(xend = 0, 
               yend = 0, 
               arrow = arrow_style) +
  labs(title = "Rotation matrix") +
  geom_text(aes(label = column),
            color = "#904C2F") +
  xlim(-1.25, .5) + 
  ylim(-.5, 1) +
  coord_fixed() + # fix aspect ratio to 1:1
  theme_minimal_grid(12)

pca_fit |>
  tidy(matrix = "eigenvalues")

pca_fit |>
  tidy(matrix = "eigenvalues") |>
  ggplot(aes(PC, percent)) +
  geom_col(fill = "#56B4E9", 
           alpha = 0.8) +
  scale_x_continuous(breaks = 1:9) +
  scale_y_continuous(labels = scales::percent_format(), 
                     expand = expansion(mult = c(0, 0.01))) +
  theme_minimal_hgrid(12)

```
